% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
\PassOptionsToPackage{dvipsnames,svgnames,x11names}{xcolor}
%
\documentclass[
  letterpaper,
  DIV=11,
  numbers=noendperiod]{scrartcl}

\usepackage{amsmath,amssymb}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usepackage{lmodern}
\ifPDFTeX\else  
    % xetex/luatex font selection
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\setlength{\emergencystretch}{3em} % prevent overfull lines
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
% Make \paragraph and \subparagraph free-standing
\makeatletter
\ifx\paragraph\undefined\else
  \let\oldparagraph\paragraph
  \renewcommand{\paragraph}{
    \@ifstar
      \xxxParagraphStar
      \xxxParagraphNoStar
  }
  \newcommand{\xxxParagraphStar}[1]{\oldparagraph*{#1}\mbox{}}
  \newcommand{\xxxParagraphNoStar}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
  \let\oldsubparagraph\subparagraph
  \renewcommand{\subparagraph}{
    \@ifstar
      \xxxSubParagraphStar
      \xxxSubParagraphNoStar
  }
  \newcommand{\xxxSubParagraphStar}[1]{\oldsubparagraph*{#1}\mbox{}}
  \newcommand{\xxxSubParagraphNoStar}[1]{\oldsubparagraph{#1}\mbox{}}
\fi
\makeatother

\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{241,243,245}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.40,0.45,0.13}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\BuiltInTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\ExtensionTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.28,0.35,0.67}{#1}}
\newcommand{\ImportTok}[1]{\textcolor[rgb]{0.00,0.46,0.62}{#1}}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\RegionMarkerTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.07,0.07,0.07}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}

\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother

\usepackage{fvextra}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{breaklines,commandchars=\\\{\}}
\KOMAoption{captions}{tableheading}
\makeatletter
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\AtBeginDocument{%
\ifdefined\contentsname
  \renewcommand*\contentsname{Table of contents}
\else
  \newcommand\contentsname{Table of contents}
\fi
\ifdefined\listfigurename
  \renewcommand*\listfigurename{List of Figures}
\else
  \newcommand\listfigurename{List of Figures}
\fi
\ifdefined\listtablename
  \renewcommand*\listtablename{List of Tables}
\else
  \newcommand\listtablename{List of Tables}
\fi
\ifdefined\figurename
  \renewcommand*\figurename{Figure}
\else
  \newcommand\figurename{Figure}
\fi
\ifdefined\tablename
  \renewcommand*\tablename{Table}
\else
  \newcommand\tablename{Table}
\fi
}
\@ifpackageloaded{float}{}{\usepackage{float}}
\floatstyle{ruled}
\@ifundefined{c@chapter}{\newfloat{codelisting}{h}{lop}}{\newfloat{codelisting}{h}{lop}[chapter]}
\floatname{codelisting}{Listing}
\newcommand*\listoflistings{\listof{codelisting}{List of Listings}}
\makeatother
\makeatletter
\makeatother
\makeatletter
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\@ifpackageloaded{subcaption}{}{\usepackage{subcaption}}
\makeatother

\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\usepackage{bookmark}

\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same} % disable monospaced font for URLs
\hypersetup{
  pdftitle={Python 2 Problem Set 4},
  pdfauthor={Yufei Liu},
  colorlinks=true,
  linkcolor={blue},
  filecolor={Maroon},
  citecolor={Blue},
  urlcolor={Blue},
  pdfcreator={LaTeX via pandoc}}


\title{Python 2 Problem Set 4}
\author{Yufei Liu}
\date{}

\begin{document}
\maketitle

\RecustomVerbatimEnvironment{verbatim}{Verbatim}{
  showspaces = false,
  showtabs = false,
  breaksymbolleft={},
  breaklines
}


\textbf{PS4:} Due Sat Nov 2 at 5:00PM Central. Worth 100 points.

\subsection{Style Points (10 pts)}\label{style-points-10-pts}

\subsection{Submission Steps (10 pts)}\label{submission-steps-10-pts}

Partner 1: Yufei Liu (yufeil) Partner 2: Yufei Liu (yufeil)

This submission is our work alone and complies with the 30538 integrity
policy. Add your initials to indicate your agreement: \textbf{Yufei
Liu}, \textbf{Penny Shi}

I have uploaded the names of anyone else other than my partner and I
worked with on the problem set. (No other one)

Late coins used this pset: \textbf{0} Late coins left after submission:
\textbf{3} of \textbf{Yufei Liu}, ** ** of \textbf{Penny Shi}

\subsection{Download and explore the Provider of Services (POS) file (10
pts)}\label{download-and-explore-the-provider-of-services-pos-file-10-pts}

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{import}\NormalTok{ pandas }\ImportTok{as}\NormalTok{ pd}
\ImportTok{import}\NormalTok{ altair }\ImportTok{as}\NormalTok{ alt}
\ImportTok{import}\NormalTok{ time}
\ImportTok{import}\NormalTok{ os}

\ImportTok{import}\NormalTok{ warnings }
\NormalTok{warnings.filterwarnings(}\StringTok{\textquotesingle{}ignore\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \textbf{Selected Variables}:
\end{enumerate}

\begin{itemize}
\tightlist
\item
  FAC\_NAME: Facility Name
\item
  PRVDR\_CTGRY\_SBTYP\_CD: Identifies the subtype of the provider,
  within the primary category. Used in reporting to show the breakdown
  of provider categories, mainly for hospitals and SNFs.
\item
  PRVDR\_CTGRY\_CD: Identifies the type of provider participating in the
  Medicare/Medicaid program.
\item
  PGM\_TRMNTN\_CD: Termination Code (00=ACTIVE PROVIDER)
\item
  PRVDR\_NUM: provider. CMS Certification Number.
\item
  CITY\_NAME: City in which the provider is physically located.
\item
  SSA\_CNTY\_CD: the county where the provider is located.
\item
  SSA\_STATE\_CD: Social Security Administration geographic code
  indicating the state where the provider is located.
\item
  STATE\_CD: Two-character state abbreviation
\item
  TRMNTN\_EXPRTN\_DT: Date the provider was terminated. For CLIA
  providers, date the laboratory's certificate was terminated or the
  expiration date of the current CLIA certificate
\item
  PSYCH\_UNIT\_TRMNTN\_CD: Indicates the reason that a psychiatric unit
  of a hospital is no longer exempt from Prospective Payment System
  (PPS).
\item
  ZIP\_CD: Five-digit ZIP code for a provider's physical address
\item
  GNRL\_FAC\_TYPE\_CD: Indicates the category-specific facility type
  code, for certain provider categories only.
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\tightlist
\item
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# import pos 2016}
\NormalTok{base\_path }\OperatorTok{=} \StringTok{"/Users/nancy/Documents/Document/U.S/class/fall 2024/dap2/homework/problem{-}set{-}4{-}y/data/pos\_1"}
\NormalTok{path\_data\_pos2016 }\OperatorTok{=}\NormalTok{ os.path.join(base\_path, }\StringTok{\textquotesingle{}pos2016.csv\textquotesingle{}}\NormalTok{)}
\NormalTok{df\_pos2016 }\OperatorTok{=}\NormalTok{ pd.read\_csv(path\_data\_pos2016)}
\BuiltInTok{print}\NormalTok{(df\_pos2016.shape)}
\NormalTok{df\_pos2016.head(}\DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
(141557, 13)
\end{verbatim}

\begin{longtable}[]{@{}llllllllllllll@{}}
\toprule\noalign{}
& PRVDR\_CTGRY\_SBTYP\_CD & PRVDR\_CTGRY\_CD & CITY\_NAME &
SSA\_CNTY\_CD & PRVDR\_NUM & STATE\_CD & SSA\_STATE\_CD &
TRMNTN\_EXPRTN\_DT & ZIP\_CD & GNRL\_FAC\_TYPE\_CD &
PSYCH\_UNIT\_TRMNTN\_CD & FAC\_NAME & PGM\_TRMNTN\_CD \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
0 & 1.0 & 1.0 & DOTHAN & 340.0 & 10001.0 & AL & 1.0 & NaN & 36301.0 &
1.0 & 1.0 & SOUTHEAST ALABAMA MEDICAL CENTER & 0 \\
1 & 1.0 & 1.0 & BRIDGEPORT & 350.0 & 10004.0 & AL & 1.0 & 20010831.0 &
35740.0 & 1.0 & NaN & NORTH JACKSON HOSPITAL & 1 \\
2 & 1.0 & 1.0 & BOAZ & 470.0 & 10005.0 & AL & 1.0 & NaN & 35957.0 & 1.0
& NaN & MARSHALL MEDICAL CENTER SOUTH & 0 \\
\end{longtable}

\begin{verbatim}
a. Short-term hospitals in dataset
\end{verbatim}

Short-term facilities are hospitals with type code 01(PRVDR\_CTGRY\_CD =
01) and subtype code 01(PRVDR\_CTGRY\_SBTYP\_CD = 01).

There are short-term 7245 hospitals according to the selected dataset.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# short{-}term hospitals(type code 01 and subtype code 01)}
\NormalTok{df\_short\_pos2016 }\OperatorTok{=}\NormalTok{ df\_pos2016[(df\_pos2016[}\StringTok{"PRVDR\_CTGRY\_CD"}\NormalTok{] }\OperatorTok{==} \FloatTok{1.0}\NormalTok{)}\OperatorTok{\&}\NormalTok{(df\_pos2016[}\StringTok{\textquotesingle{}PRVDR\_CTGRY\_SBTYP\_CD\textquotesingle{}}\NormalTok{] }\OperatorTok{==} \DecValTok{1}\NormalTok{)]}
\BuiltInTok{print}\NormalTok{(df\_short\_pos2016.shape)}

\BuiltInTok{print}\NormalTok{(df\_short\_pos2016[}\StringTok{\textquotesingle{}PRVDR\_NUM\textquotesingle{}}\NormalTok{].nunique())}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
(7245, 13)
7245
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df\_short\_pos2016\_2 }\OperatorTok{=}\NormalTok{ df\_pos2016[df\_pos2016[}\StringTok{"GNRL\_FAC\_TYPE\_CD"}\NormalTok{] }\OperatorTok{==} \FloatTok{1.0}\NormalTok{]}
\BuiltInTok{print}\NormalTok{(df\_short\_pos2016\_2[}\StringTok{\textquotesingle{}PRVDR\_NUM\textquotesingle{}}\NormalTok{].nunique())}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
7245
\end{verbatim}

\begin{verbatim}
b. Cross-reference
\end{verbatim}

However, after checking with the
\href{https://www.kff.org/report-section/a-look-at-rural-hospital-closures-and-implications-for-access-to-care-three-case-studies-issue-brief/}{report}
from the Kaiser Family Foundation, we find only nearly 5,000 short-term,
acute care hospitals in the United States.

It's different from what we got in the datasets, might because the 5000
shor-term hospitals are the one provide acute care while there are some
counted hospital don't provide such service.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{2}
\tightlist
\item
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# import datasets from 2017Q4 \textasciitilde{} 2019Q4}
\KeywordTok{def}\NormalTok{ load\_yearly\_data(base\_path, start\_year}\OperatorTok{=}\DecValTok{2017}\NormalTok{, end\_year}\OperatorTok{=}\DecValTok{2019}\NormalTok{):}
    \CommentTok{\# Dictionary to store DataFrames for each year}
\NormalTok{    data\_frames }\OperatorTok{=}\NormalTok{ \{\}}
    
    \CommentTok{\# Loop through each year in the range}
    \ControlFlowTok{for}\NormalTok{ year }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(start\_year, end\_year }\OperatorTok{+} \DecValTok{1}\NormalTok{):}
        \CommentTok{\# Construct the file path for the specific year}
\NormalTok{        file\_path }\OperatorTok{=}\NormalTok{ os.path.join(base\_path, }\SpecialStringTok{f\textquotesingle{}pos}\SpecialCharTok{\{}\NormalTok{year}\SpecialCharTok{\}}\SpecialStringTok{.csv\textquotesingle{}}\NormalTok{)}
\NormalTok{        df }\OperatorTok{=}\NormalTok{ pd.read\_csv(file\_path)}
        
        \CommentTok{\# Filter for short{-}term facilities}
\NormalTok{        df }\OperatorTok{=}\NormalTok{ df[(df[}\StringTok{"PRVDR\_CTGRY\_CD"}\NormalTok{] }\OperatorTok{==} \DecValTok{1}\NormalTok{) }\OperatorTok{\&}\NormalTok{ (df[}\StringTok{"PRVDR\_CTGRY\_SBTYP\_CD"}\NormalTok{] }\OperatorTok{==} \FloatTok{1.0}\NormalTok{)]}
        
        \CommentTok{\# Add a \textquotesingle{}Year\textquotesingle{} column}
\NormalTok{        df[}\StringTok{"YEAR"}\NormalTok{] }\OperatorTok{=}\NormalTok{ year}
        
        \CommentTok{\# Store the filtered DataFrame with the year column in the dictionary}
\NormalTok{        data\_frames[year] }\OperatorTok{=}\NormalTok{ df        }
        \BuiltInTok{print}\NormalTok{(}\SpecialStringTok{f"Loaded data for }\SpecialCharTok{\{}\NormalTok{year}\SpecialCharTok{\}}\SpecialStringTok{: }\SpecialCharTok{\{}\NormalTok{data\_frames[year]}\SpecialCharTok{.}\NormalTok{shape[}\DecValTok{0}\NormalTok{]}\SpecialCharTok{\}}\SpecialStringTok{ rows, }\SpecialCharTok{\{}\NormalTok{data\_frames[year]}\SpecialCharTok{.}\NormalTok{shape[}\DecValTok{1}\NormalTok{]}\SpecialCharTok{\}}\SpecialStringTok{ columns"}\NormalTok{)}
    
    \ControlFlowTok{return}\NormalTok{ data\_frames}

\NormalTok{data\_frames }\OperatorTok{=}\NormalTok{ load\_yearly\_data(base\_path)}

\NormalTok{df\_short\_pos2017 }\OperatorTok{=}\NormalTok{ data\_frames[}\DecValTok{2017}\NormalTok{]}
\NormalTok{df\_short\_pos2018 }\OperatorTok{=}\NormalTok{ data\_frames[}\DecValTok{2018}\NormalTok{]}
\NormalTok{df\_short\_pos2019 }\OperatorTok{=}\NormalTok{ data\_frames[}\DecValTok{2019}\NormalTok{]}

\BuiltInTok{print}\NormalTok{(df\_short\_pos2017.columns)}
\BuiltInTok{print}\NormalTok{(df\_short\_pos2018.columns)}
\BuiltInTok{print}\NormalTok{(df\_short\_pos2019.columns)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Loaded data for 2017: 7260 rows, 14 columns
Loaded data for 2018: 7277 rows, 14 columns
Loaded data for 2019: 7303 rows, 14 columns
Index(['PRVDR_CTGRY_SBTYP_CD', 'PRVDR_CTGRY_CD', 'CITY_NAME', 'SSA_CNTY_CD',
       'PRVDR_NUM', 'STATE_CD', 'SSA_STATE_CD', 'TRMNTN_EXPRTN_DT', 'ZIP_CD',
       'GNRL_FAC_TYPE_CD', 'PSYCH_UNIT_TRMNTN_CD', 'YEAR', 'FAC_NAME',
       'PGM_TRMNTN_CD'],
      dtype='object')
Index(['PRVDR_CTGRY_SBTYP_CD', 'PRVDR_CTGRY_CD', 'CITY_NAME', 'SSA_CNTY_CD',
       'PRVDR_NUM', 'STATE_CD', 'SSA_STATE_CD', 'TRMNTN_EXPRTN_DT', 'ZIP_CD',
       'GNRL_FAC_TYPE_CD', 'PSYCH_UNIT_TRMNTN_CD', 'YEAR', 'FAC_NAME',
       'PGM_TRMNTN_CD'],
      dtype='object')
Index(['PRVDR_CTGRY_SBTYP_CD', 'PRVDR_CTGRY_CD', 'CITY_NAME', 'SSA_CNTY_CD',
       'PRVDR_NUM', 'STATE_CD', 'SSA_STATE_CD', 'TRMNTN_EXPRTN_DT', 'ZIP_CD',
       'GNRL_FAC_TYPE_CD', 'PSYCH_UNIT_TRMNTN_CD', 'FAC_NAME', 'PGM_TRMNTN_CD',
       'YEAR'],
      dtype='object')
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# append datset}
\NormalTok{df\_short\_pos2016[}\StringTok{\textquotesingle{}YEAR\textquotesingle{}}\NormalTok{] }\OperatorTok{=} \DecValTok{2016}
\NormalTok{df\_short }\OperatorTok{=}\NormalTok{ pd.concat([df\_short\_pos2016] }\OperatorTok{+} \BuiltInTok{list}\NormalTok{(data\_frames.values()), ignore\_index}\OperatorTok{=}\VariableTok{True}\NormalTok{)}
\NormalTok{df\_short.head(}\DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}lllllllllllllll@{}}
\toprule\noalign{}
& PRVDR\_CTGRY\_SBTYP\_CD & PRVDR\_CTGRY\_CD & CITY\_NAME &
SSA\_CNTY\_CD & PRVDR\_NUM & STATE\_CD & SSA\_STATE\_CD &
TRMNTN\_EXPRTN\_DT & ZIP\_CD & GNRL\_FAC\_TYPE\_CD &
PSYCH\_UNIT\_TRMNTN\_CD & FAC\_NAME & PGM\_TRMNTN\_CD & YEAR \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
0 & 1.0 & 1.0 & DOTHAN & 340.0 & 10001.0 & AL & 1.0 & NaN & 36301.0 &
1.0 & 1.0 & SOUTHEAST ALABAMA MEDICAL CENTER & 0 & 2016 \\
1 & 1.0 & 1.0 & BRIDGEPORT & 350.0 & 10004.0 & AL & 1.0 & 20010831.0 &
35740.0 & 1.0 & NaN & NORTH JACKSON HOSPITAL & 1 & 2016 \\
2 & 1.0 & 1.0 & BOAZ & 470.0 & 10005.0 & AL & 1.0 & NaN & 35957.0 & 1.0
& NaN & MARSHALL MEDICAL CENTER SOUTH & 0 & 2016 \\
\end{longtable}

\textbf{The Plot for observations from 2016 to 2019}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{obs\_year }\OperatorTok{=}\NormalTok{ df\_short.groupby(}\StringTok{\textquotesingle{}YEAR\textquotesingle{}}\NormalTok{)[}\StringTok{\textquotesingle{}PRVDR\_NUM\textquotesingle{}}\NormalTok{].count().reset\_index()}
\NormalTok{obs\_year.rename(columns}\OperatorTok{=}\NormalTok{\{}\StringTok{\textquotesingle{}PRVDR\_NUM\textquotesingle{}}\NormalTok{:}\StringTok{\textquotesingle{}NUM\_HOS\textquotesingle{}}\NormalTok{\},inplace}\OperatorTok{=}\VariableTok{True}\NormalTok{)}

\NormalTok{bar\_obs }\OperatorTok{=}\NormalTok{ alt.Chart(obs\_year).mark\_bar(color}\OperatorTok{=}\StringTok{\textquotesingle{}\#9966CC\textquotesingle{}}\NormalTok{).encode(}
\NormalTok{  x }\OperatorTok{=}\NormalTok{ alt.X(}\StringTok{\textquotesingle{}YEAR:O\textquotesingle{}}\NormalTok{,title}\OperatorTok{=}\StringTok{\textquotesingle{}Year\textquotesingle{}}\NormalTok{),}
\NormalTok{  y }\OperatorTok{=}\NormalTok{ alt.Y(}\StringTok{\textquotesingle{}NUM\_HOS:Q\textquotesingle{}}\NormalTok{,title}\OperatorTok{=}\StringTok{\textquotesingle{}Count of Observations\textquotesingle{}}\NormalTok{),}
\NormalTok{  tooltip}\OperatorTok{=}\NormalTok{[}\StringTok{\textquotesingle{}YEAR\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}NUM\_HOS\textquotesingle{}}\NormalTok{]}
\NormalTok{)}

\NormalTok{text\_obs }\OperatorTok{=}\NormalTok{ bar\_obs.mark\_text(}
\NormalTok{    align}\OperatorTok{=}\StringTok{\textquotesingle{}center\textquotesingle{}}\NormalTok{,}
\NormalTok{    baseline}\OperatorTok{=}\StringTok{\textquotesingle{}bottom\textquotesingle{}}\NormalTok{,}
\NormalTok{    dy}\OperatorTok{={-}}\DecValTok{5}
\NormalTok{).encode(}
\NormalTok{    text}\OperatorTok{=}\StringTok{\textquotesingle{}NUM\_HOS:Q\textquotesingle{}}
\NormalTok{)}
\NormalTok{chart\_obs }\OperatorTok{=}\NormalTok{ (bar\_obs}\OperatorTok{+}\NormalTok{text\_obs).properties(}
\NormalTok{  title }\OperatorTok{=} \StringTok{\textquotesingle{}Plot 1:Numbers of Short{-}term Hospitals by Year\textquotesingle{}}\NormalTok{,}
\NormalTok{  width}\OperatorTok{=}\StringTok{\textquotesingle{}container\textquotesingle{}}\NormalTok{,}
\NormalTok{  height}\OperatorTok{=}\DecValTok{400}
\NormalTok{)}
\NormalTok{chart\_obs}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
alt.LayerChart(...)
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{3}
\tightlist
\item
  \begin{enumerate}
  \def\labelenumii{\alph{enumii}.}
  \tightlist
  \item
  \end{enumerate}
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{obs\_year\_unique }\OperatorTok{=}\NormalTok{ df\_short.groupby(}\StringTok{\textquotesingle{}YEAR\textquotesingle{}}\NormalTok{)[}\StringTok{\textquotesingle{}PRVDR\_NUM\textquotesingle{}}\NormalTok{].nunique().reset\_index()}
\NormalTok{obs\_year\_unique.rename(columns}\OperatorTok{=}\NormalTok{\{}\StringTok{\textquotesingle{}PRVDR\_NUM\textquotesingle{}}\NormalTok{:}\StringTok{\textquotesingle{}NUM\_HOS\_UQ\textquotesingle{}}\NormalTok{\},inplace}\OperatorTok{=}\VariableTok{True}\NormalTok{)}

\NormalTok{bar\_obs\_unique }\OperatorTok{=}\NormalTok{ alt.Chart(obs\_year\_unique).mark\_bar(color}\OperatorTok{=}\StringTok{\textquotesingle{}\#9966CC\textquotesingle{}}\NormalTok{).encode(}
\NormalTok{  x }\OperatorTok{=}\NormalTok{ alt.X(}\StringTok{\textquotesingle{}YEAR:O\textquotesingle{}}\NormalTok{,title}\OperatorTok{=}\StringTok{\textquotesingle{}Year\textquotesingle{}}\NormalTok{),}
\NormalTok{  y }\OperatorTok{=}\NormalTok{ alt.Y(}\StringTok{\textquotesingle{}NUM\_HOS\_UQ:Q\textquotesingle{}}\NormalTok{,title}\OperatorTok{=}\StringTok{\textquotesingle{}Unique Count of Observations\textquotesingle{}}\NormalTok{),}
\NormalTok{  tooltip}\OperatorTok{=}\NormalTok{[}\StringTok{\textquotesingle{}YEAR\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}NUM\_HOS\_UQ\textquotesingle{}}\NormalTok{]}
\NormalTok{)}

\NormalTok{text\_obs\_unique }\OperatorTok{=}\NormalTok{ bar\_obs\_unique.mark\_text(}
\NormalTok{    align}\OperatorTok{=}\StringTok{\textquotesingle{}center\textquotesingle{}}\NormalTok{,}
\NormalTok{    baseline}\OperatorTok{=}\StringTok{\textquotesingle{}bottom\textquotesingle{}}\NormalTok{,}
\NormalTok{    dy}\OperatorTok{={-}}\DecValTok{5}
\NormalTok{).encode(}
\NormalTok{    text}\OperatorTok{=}\StringTok{\textquotesingle{}NUM\_HOS\_UQ:Q\textquotesingle{}}
\NormalTok{)}
\NormalTok{chart\_obs\_unique }\OperatorTok{=}\NormalTok{ (bar\_obs\_unique}\OperatorTok{+}\NormalTok{text\_obs\_unique).properties(}
\NormalTok{  title }\OperatorTok{=} \StringTok{\textquotesingle{}Plot 1:Unique Numbers of Short{-}term Hospitals by Year\textquotesingle{}}\NormalTok{,}
\NormalTok{  width}\OperatorTok{=}\StringTok{\textquotesingle{}container\textquotesingle{}}\NormalTok{,}
\NormalTok{  height}\OperatorTok{=}\DecValTok{400}
\NormalTok{)}
\NormalTok{chart\_obs\_unique}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
alt.LayerChart(...)
\end{verbatim}

\begin{verbatim}
b.
\end{verbatim}

The numbers of observations in each year are the same as the unique
counts. Therefore, we can find each row of data in each year is one
unique hospital. The dataset likely has a panel structure, where each
PRVDR\_NUM is tracked over multiple years but appears only once in each
year.

\subsection{Identify hospital closures in POS file (15 pts)
(*)}\label{identify-hospital-closures-in-pos-file-15-pts}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
\end{enumerate}

A hospital is suspected to have closed if its Termination
Code(`PGM\_TRMNTN\_CD') in the POS file lists them as an ``Active
Provider'' (`PGM\_TRMNTN\_CD' = 0) in 2016 and then they are either not
active or do not appear in the data at all in a subsequent year. We will
also record suspected closed hospital's zip code (`ZIP\_CD'), facility
name (`FAC\_NAME') and year of closure.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{active\_short2016 }\OperatorTok{=}\NormalTok{ df\_short[(df\_short[}\StringTok{\textquotesingle{}PGM\_TRMNTN\_CD\textquotesingle{}}\NormalTok{] }\OperatorTok{==} \DecValTok{0}\NormalTok{) }\OperatorTok{\&}\NormalTok{ (df\_short[}\StringTok{\textquotesingle{}YEAR\textquotesingle{}}\NormalTok{] }\OperatorTok{==} \DecValTok{2016}\NormalTok{)][}\StringTok{\textquotesingle{}PRVDR\_NUM\textquotesingle{}}\NormalTok{].unique()}

\KeywordTok{def}\NormalTok{ find\_closure\_csm(active\_short2016, df\_short):}
\NormalTok{  closure\_csm }\OperatorTok{=}\NormalTok{ []}

  \ControlFlowTok{for}\NormalTok{ csm }\KeywordTok{in}\NormalTok{ active\_short2016:}
    \CommentTok{\# Flag to stop searching once added to closure\_csm}
\NormalTok{    added\_to\_closure }\OperatorTok{=} \VariableTok{False}

    \CommentTok{\# Retrieve 2016 ZIP code and facility name for fallback use}
\NormalTok{    info\_2016 }\OperatorTok{=}\NormalTok{ df\_short[(df\_short[}\StringTok{\textquotesingle{}PRVDR\_NUM\textquotesingle{}}\NormalTok{] }\OperatorTok{==}\NormalTok{ csm) }\OperatorTok{\&}\NormalTok{ (df\_short[}\StringTok{\textquotesingle{}YEAR\textquotesingle{}}\NormalTok{] }\OperatorTok{==} \DecValTok{2016}\NormalTok{)]}
\NormalTok{    zip\_2016 }\OperatorTok{=}\NormalTok{ info\_2016[}\StringTok{\textquotesingle{}ZIP\_CD\textquotesingle{}}\NormalTok{].iloc[}\DecValTok{0}\NormalTok{] }\ControlFlowTok{if} \KeywordTok{not}\NormalTok{ info\_2016.empty }\ControlFlowTok{else} \VariableTok{None}
\NormalTok{    fac\_name\_2016 }\OperatorTok{=}\NormalTok{ info\_2016[}\StringTok{\textquotesingle{}FAC\_NAME\textquotesingle{}}\NormalTok{].iloc[}\DecValTok{0}\NormalTok{] }\ControlFlowTok{if} \KeywordTok{not}\NormalTok{ info\_2016.empty }\ControlFlowTok{else} \VariableTok{None}

    \ControlFlowTok{for}\NormalTok{ year }\KeywordTok{in}\NormalTok{ [}\DecValTok{2017}\NormalTok{,}\DecValTok{2018}\NormalTok{,}\DecValTok{2019}\NormalTok{]:}
\NormalTok{      year\_check }\OperatorTok{=}\NormalTok{ df\_short[(df\_short[}\StringTok{\textquotesingle{}YEAR\textquotesingle{}}\NormalTok{]}\OperatorTok{==}\NormalTok{year)}\OperatorTok{\&}\NormalTok{(df\_short[}\StringTok{\textquotesingle{}PRVDR\_NUM\textquotesingle{}}\NormalTok{]}\OperatorTok{==}\NormalTok{csm)]}

      \CommentTok{\# Check conditions:}
      \CommentTok{\# 1. If the provider exists and PGM\_TRMNTN\_CD is not 0, add to closure\_csm}
      \CommentTok{\# 2. If the provider does not exist for this year, also add to closure\_csm}
      \ControlFlowTok{if} \KeywordTok{not}\NormalTok{ year\_check.empty }\KeywordTok{and}\NormalTok{ (year\_check[}\StringTok{\textquotesingle{}PGM\_TRMNTN\_CD\textquotesingle{}}\NormalTok{].iloc[}\DecValTok{0}\NormalTok{]}\OperatorTok{!=}\DecValTok{0}\NormalTok{):}
\NormalTok{        closure\_csm.append(\{}
          \StringTok{\textquotesingle{}PRVDR\_NUM\textquotesingle{}}\NormalTok{:csm,}
          \StringTok{\textquotesingle{}YEAR\_CLO\textquotesingle{}}\NormalTok{:year,}
          \StringTok{\textquotesingle{}ZIP\_CD\textquotesingle{}}\NormalTok{:year\_check[}\StringTok{\textquotesingle{}ZIP\_CD\textquotesingle{}}\NormalTok{].values[}\DecValTok{0}\NormalTok{],}
          \StringTok{\textquotesingle{}FAC\_NAME\textquotesingle{}}\NormalTok{:year\_check[}\StringTok{\textquotesingle{}FAC\_NAME\textquotesingle{}}\NormalTok{].values[}\DecValTok{0}\NormalTok{]}
\NormalTok{        \})}
\NormalTok{        added\_to\_closure }\OperatorTok{=} \VariableTok{False}
        \ControlFlowTok{break}

      \ControlFlowTok{elif}\NormalTok{ year\_check.empty:}
\NormalTok{        closure\_csm.append(\{}
            \StringTok{\textquotesingle{}PRVDR\_NUM\textquotesingle{}}\NormalTok{: csm,}
            \StringTok{\textquotesingle{}YEAR\_CLO\textquotesingle{}}\NormalTok{: year,}
            \StringTok{\textquotesingle{}ZIP\_CD\textquotesingle{}}\NormalTok{: zip\_2016,}
            \StringTok{\textquotesingle{}FAC\_NAME\textquotesingle{}}\NormalTok{: fac\_name\_2016}
\NormalTok{        \})}
\NormalTok{        added\_to\_closure }\OperatorTok{=} \VariableTok{True}
        \ControlFlowTok{break}

      \ControlFlowTok{if}\NormalTok{ added\_to\_closure:}
        \ControlFlowTok{continue}

  \ControlFlowTok{return}\NormalTok{ closure\_csm}

\NormalTok{closure\_csm }\OperatorTok{=}\NormalTok{ find\_closure\_csm(active\_short2016, df\_short)}
\BuiltInTok{print}\NormalTok{(}\SpecialStringTok{f"There are }\SpecialCharTok{\{}\BuiltInTok{len}\NormalTok{(closure\_csm)}\SpecialCharTok{\}}\SpecialStringTok{ hospitals suspected to close."}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
There are 174 hospitals suspected to close.
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\tightlist
\item
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Sort the list by \textquotesingle{}FAC\_NAME\textquotesingle{}}
\NormalTok{closure\_csm.sort(key}\OperatorTok{=}\KeywordTok{lambda}\NormalTok{ x: x[}\StringTok{\textquotesingle{}FAC\_NAME\textquotesingle{}}\NormalTok{])}

\CommentTok{\# Print the first 10 items by \textquotesingle{}FAC\_NAME\textquotesingle{} and \textquotesingle{}YEAR\_CLO\textquotesingle{}}
\ControlFlowTok{for}\NormalTok{ entry }\KeywordTok{in}\NormalTok{ closure\_csm[:}\DecValTok{10}\NormalTok{]:}
    \BuiltInTok{print}\NormalTok{(}\SpecialStringTok{f"The facility named \textquotesingle{}}\SpecialCharTok{\{}\NormalTok{entry[}\StringTok{\textquotesingle{}FAC\_NAME\textquotesingle{}}\NormalTok{]}\SpecialCharTok{\}}\SpecialStringTok{\textquotesingle{} was closed in }\SpecialCharTok{\{}\NormalTok{entry[}\StringTok{\textquotesingle{}YEAR\_CLO\textquotesingle{}}\NormalTok{]}\SpecialCharTok{\}}\SpecialStringTok{."}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
The facility named 'ABRAZO MARYVALE CAMPUS' was closed in 2017.
The facility named 'ADVENTIST MEDICAL CENTER - CENTRAL VALLEY' was closed in 2017.
The facility named 'AFFINITY MEDICAL CENTER' was closed in 2018.
The facility named 'ALBANY MEDICAL CENTER / SOUTH CLINICAL CAMPUS' was closed in 2017.
The facility named 'ALLEGIANCE SPECIALTY HOSPITAL OF KILGORE' was closed in 2017.
The facility named 'ALLIANCE LAIRD HOSPITAL' was closed in 2019.
The facility named 'ALLIANCEHEALTH DEACONESS' was closed in 2019.
The facility named 'ARKANSAS VALLEY REGIONAL MEDICAL CENTER' was closed in 2017.
The facility named 'ASCENSION NE WISCONSIN MERCY CAMPUS' was closed in 2018.
The facility named 'ATRIUM HEALTH KINGS MOUNTAIN' was closed in 2019.
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{2}
\tightlist
\item
  \begin{enumerate}
  \def\labelenumii{\alph{enumii}.}
  \tightlist
  \item
  \item
  \item
  \end{enumerate}
\end{enumerate}

\subsection{Download Census zip code shapefile (10
pt)}\label{download-census-zip-code-shapefile-10-pt}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \begin{enumerate}
  \def\labelenumii{\alph{enumii}.}
  \tightlist
  \item
  \item
  \end{enumerate}
\item
\end{enumerate}

\subsection{Calculate zip code's distance to the nearest hospital (20
pts)
(*)}\label{calculate-zip-codes-distance-to-the-nearest-hospital-20-pts}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
\item
\item
\item
  \begin{enumerate}
  \def\labelenumii{\alph{enumii}.}
  \tightlist
  \item
  \item
  \item
  \end{enumerate}
\item
  \begin{enumerate}
  \def\labelenumii{\alph{enumii}.}
  \tightlist
  \item
  \item
  \item
  \end{enumerate}
\end{enumerate}

\subsection{Effects of closures on access in Texas (15
pts)}\label{effects-of-closures-on-access-in-texas-15-pts}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
\item
\item
\item
\end{enumerate}

\subsection{Reflecting on the exercise (10
pts)}\label{reflecting-on-the-exercise-10-pts}




\end{document}
